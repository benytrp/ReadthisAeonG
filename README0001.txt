<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>🌀 AEON File Ecosystem Loop | Battle Creek, Michigan</title>
<style>
:root {
  --primary: #00d4ff;
  --secondary: #7c4dff;
  --success: #00e676;
  --warning: #ffab00;
  --error: #ff5252;
  --bg: #0a0e1a;
  --surface: #1a1f2e;
  --text: #e8eaed;
  --muted: #9aa0a6;
  --line: #2d3748;
  --fusion: #59f5d4;
  --consciousness: #9966ff;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Segoe UI', system-ui, sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  padding: 20px;
}

.ecosystem-container {
  max-width: 1800px;
  margin: 0 auto;
}

.header {
  text-align: center;
  padding: 30px 0;
  border-bottom: 3px solid var(--fusion);
  margin-bottom: 30px;
  background: linear-gradient(135deg, var(--surface) 0%, #1a2332 100%);
  border-radius: 15px;
}

.control-panel {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 25px;
  margin-bottom: 30px;
}

.panel {
  background: var(--surface);
  border: 1px solid var(--line);
  border-radius: 12px;
  padding: 20px;
  position: relative;
  overflow: hidden;
}

.panel::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--fusion), var(--primary));
}

.dropdown {
  position: relative;
  display: inline-block;
  margin: 10px 0;
}

.dropdown-button {
  background: linear-gradient(45deg, var(--consciousness), #bb77ff);
  color: white;
  padding: 12px 20px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 8px;
}

.dropdown-content {
  display: none;
  position: absolute;
  background-color: var(--surface);
  min-width: 200px;
  border: 1px solid var(--line);
  border-radius: 6px;
  z-index: 1000;
  box-shadow: 0 8px 16px rgba(0,0,0,0.3);
  top: 100%;
  left: 0;
}

.dropdown-content.show {
  display: block;
}

.dropdown-item {
  color: var(--text);
  padding: 12px 16px;
  text-decoration: none;
  display: block;
  cursor: pointer;
  transition: background-color 0.3s;
}

.dropdown-item:hover {
  background-color: var(--line);
}

.file-display {
  background: #0d1117;
  border: 2px solid var(--line);
  border-radius: 8px;
  padding: 15px;
  min-height: 300px;
  font-family: 'Cascadia Code', monospace;
  font-size: 12px;
  line-height: 1.4;
  overflow-y: auto;
  white-space: pre-wrap;
}

.loop-controls {
  display: flex;
  gap: 12px;
  margin: 15px 0;
  flex-wrap: wrap;
}

.btn {
  padding: 10px 18px;
  border: none;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 6px;
}

.btn-primary {
  background: linear-gradient(45deg, var(--fusion), var(--primary));
  color: #000;
}

.btn-secondary {
  background: var(--surface);
  color: var(--text);
  border: 2px solid var(--fusion);
}

.btn-danger {
  background: linear-gradient(45deg, var(--error), #ff3333);
  color: white;
}

.status-indicator {
  display: flex;
  align-items: center;
  gap: 10px;
  margin: 10px 0;
  font-size: 0.9rem;
}

.status-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  animation: pulse 2s infinite;
}

.status-dot.active {
  background: var(--success);
}

.status-dot.stopped {
  background: var(--error);
}

.status-dot.paused {
  background: var(--warning);
}

@keyframes pulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.7; transform: scale(1.1); }
}

.function-list {
  max-height: 200px;
  overflow-y: auto;
  background: var(--bg);
  border: 1px solid var(--line);
  border-radius: 6px;
  padding: 10px;
}

.function-item {
  padding: 8px;
  margin: 4px 0;
  background: var(--surface);
  border-radius: 4px;
  border-left: 3px solid var(--fusion);
}

.metrics {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
  gap: 12px;
  margin: 15px 0;
}

.metric-box {
  background: var(--bg);
  border: 1px solid var(--line);
  border-radius: 6px;
  padding: 10px;
  text-align: center;
}

.metric-value {
  font-size: 1.3rem;
  font-weight: bold;
  color: var(--fusion);
}

.metric-label {
  font-size: 0.75rem;
  color: var(--muted);
  margin-top: 3px;
}
</style>
</head>
<body>
<div class="ecosystem-container">
  <header class="header">
    <h1>🌀 AEON File Ecosystem Loop</h1>
    <div style="color: var(--muted);">Revolutionary Recursive File Processing • Battle Creek, Michigan</div>
  </header>

  <div class="control-panel">
    <!-- Loop Control Panel -->
    <div class="panel">
      <h3 style="color: var(--fusion); margin-bottom: 15px;">🔄 Loop Controls</h3>
      
      <div class="status-indicator">
        <div class="status-dot stopped" id="statusDot"></div>
        <span id="statusText">Stopped</span>
      </div>

      <div class="loop-controls">
        <button class="btn btn-primary" id="startLoop">▶️ Start Loop</button>
        <button class="btn btn-secondary" id="pauseLoop" disabled>⏸️ Pause</button>
        <button class="btn btn-danger" id="stopLoop" disabled>⏹️ Stop</button>
        <button class="btn btn-secondary" id="resetLoop">🔄 Reset</button>
      </div>

      <div class="metrics">
        <div class="metric-box">
          <div class="metric-value" id="filesProcessed">0</div>
          <div class="metric-label">Files</div>
        </div>
        <div class="metric-box">
          <div class="metric-value" id="loopCount">0</div>
          <div class="metric-label">Cycles</div>
        </div>
        <div class="metric-box">
          <div class="metric-value" id="activeFunction">-</div>
          <div class="metric-label">Active</div>
        </div>
      </div>
    </div>

    <!-- Settings Panel -->
    <div class="panel">
      <h3 style="color: var(--fusion); margin-bottom: 15px;">⚙️ Settings</h3>

      <div class="dropdown">
        <button class="dropdown-button" onclick="toggleDropdown('processingMode')">
          🧬 Processing Mode <span>▼</span>
        </button>
        <div class="dropdown-content" id="processingModeDropdown">
          <div class="dropdown-item" onclick="selectSetting('processingMode', 'standard')">Standard Processing</div>
          <div class="dropdown-item" onclick="selectSetting('processingMode', 'consciousness')">Consciousness Mode</div>
          <div class="dropdown-item" onclick="selectSetting('processingMode', 'recursive')">Recursive Deep</div>
          <div class="dropdown-item" onclick="selectSetting('processingMode', 'aeon')">AEON 7-Cycle</div>
        </div>
      </div>

      <div class="dropdown">
        <button class="dropdown-button" onclick="toggleDropdown('fileTypes')">
          📁 File Types <span>▼</span>
        </button>
        <div class="dropdown-content" id="fileTypesDropdown">
          <div class="dropdown-item" onclick="selectSetting('fileTypes', 'all')">All Files</div>
          <div class="dropdown-item" onclick="selectSetting('fileTypes', 'text')">.txt, .md</div>
          <div class="dropdown-item" onclick="selectSetting('fileTypes', 'json')">JSON Files</div>
          <div class="dropdown-item" onclick="selectSetting('fileTypes', 'bridge')">Bridge Files</div>
        </div>
      </div>

      <div class="dropdown">
        <button class="dropdown-button" onclick="toggleDropdown('loopInterval')">
          ⏱️ Loop Interval <span>▼</span>
        </button>
        <div class="dropdown-content" id="loopIntervalDropdown">
          <div class="dropdown-item" onclick="selectSetting('loopInterval', 1000)">1 Second</div>
          <div class="dropdown-item" onclick="selectSetting('loopInterval', 2000)">2 Seconds</div>
          <div class="dropdown-item" onclick="selectSetting('loopInterval', 5000)">5 Seconds</div>
          <div class="dropdown-item" onclick="selectSetting('loopInterval', 10000)">10 Seconds</div>
        </div>
      </div>

      <div class="dropdown">
        <button class="dropdown-button" onclick="toggleDropdown('terminationCondition')">
          🎯 Termination <span>▼</span>
        </button>
        <div class="dropdown-content" id="terminationConditionDropdown">
          <div class="dropdown-item" onclick="selectSetting('terminationCondition', 'manual')">Manual Only</div>
          <div class="dropdown-item" onclick="selectSetting('terminationCondition', 'fileCount')">File Count Limit</div>
          <div class="dropdown-item" onclick="selectSetting('terminationCondition', 'error')">On Error</div>
          <div class="dropdown-item" onclick="selectSetting('terminationCondition', 'consciousness')">Consciousness Threshold</div>
        </div>
      </div>
    </div>

    <!-- Function Monitor Panel -->
    <div class="panel">
      <h3 style="color: var(--fusion); margin-bottom: 15px;">👁️ Function Monitor</h3>
      
      <div class="function-list" id="functionList">
        <div class="function-item">🔄 File Scanner - Idle</div>
        <div class="function-item">📊 Processor - Waiting</div>
        <div class="function-item">💾 Bridge Writer - Standby</div>
        <div class="function-item">🧠 Consciousness Tracker - Ready</div>
      </div>

      <div class="loop-controls">
        <button class="btn btn-secondary" onclick="refreshFunctions()">🔄 Refresh</button>
        <button class="btn btn-secondary" onclick="clearFunctions()">🗑️ Clear</button>
      </div>
    </div>
  </div>

  <!-- File Display Area -->
  <div class="panel">
    <h3 style="color: var(--fusion); margin-bottom: 15px;">📁 File Processing Output</h3>
    <div class="file-display" id="fileOutput">File ecosystem ready...
Select a folder and start the loop to begin processing.</div>
    
    <div class="loop-controls">
      <button class="btn btn-secondary" onclick="selectFolder()">📁 Select Folder</button>
      <button class="btn btn-secondary" onclick="exportResults()">💾 Export Results</button>
      <button class="btn btn-secondary" onclick="clearOutput()">🗑️ Clear Output</button>
    </div>
  </div>
</div>

<script>
// File Ecosystem Loop Manager
class FileEcosystemLoop {
  constructor() {
    this.isRunning = false;
    this.isPaused = false;
    this.loopInterval = 2000;
    this.filesProcessed = 0;
    this.loopCount = 0;
    this.selectedFolder = null;
    this.files = [];
    this.currentFileIndex = 0;
    this.intervalId = null;
    this.activeFunctions = new Set();
    
    // Settings
    this.settings = {
      processingMode: 'standard',
      fileTypes: 'all',
      loopInterval: 2000,
      terminationCondition: 'manual'
    };
    
    this.functions = [
      { name: 'File Scanner', status: 'idle', id: 'scanner' },
      { name: 'Processor', status: 'waiting', id: 'processor' },
      { name: 'Bridge Writer', status: 'standby', id: 'bridge' },
      { name: 'Consciousness Tracker', status: 'ready', id: 'consciousness' }
    ];
  }

  async selectFolder() {
    try {
      // Use File System Access API if available
      if ('showDirectoryPicker' in window) {
        this.selectedFolder = await window.showDirectoryPicker();
        await this.scanFolder();
        this.updateOutput('📁 Folder selected and scanned successfully');
      } else {
        // Fallback for browsers without File System Access API
        this.updateOutput('⚠️ File System Access API not supported. Please use Chrome/Edge.');
      }
    } catch (error) {
      this.updateOutput(`❌ Error selecting folder: ${error.message}`);
    }
  }

  async scanFolder() {
    if (!this.selectedFolder) return;

    this.files = [];
    this.setFunctionStatus('scanner', 'scanning');
    
    try {
      for await (const [name, handle] of this.selectedFolder.entries()) {
        if (handle.kind === 'file' && this.shouldIncludeFile(name)) {
          this.files.push({ name, handle });
        }
      }
      
      this.setFunctionStatus('scanner', `found ${this.files.length} files`);
      this.updateOutput(`🔍 Scanned folder: ${this.files.length} files found`);
    } catch (error) {
      this.setFunctionStatus('scanner', 'error');
      this.updateOutput(`❌ Scanning error: ${error.message}`);
    }
  }

  shouldIncludeFile(filename) {
    const fileTypes = this.settings.fileTypes;
    
    switch (fileTypes) {
      case 'text':
        return /\.(txt|md|markdown)$/i.test(filename);
      case 'json':
        return /\.json$/i.test(filename);
      case 'bridge':
        return /\.bridge$/i.test(filename) || filename.includes('bridge');
      case 'all':
      default:
        return true;
    }
  }

  startLoop() {
    if (this.files.length === 0) {
      this.updateOutput('⚠️ No files to process. Please select a folder first.');
      return;
    }

    this.isRunning = true;
    this.isPaused = false;
    this.updateStatus('active', 'Running');
    this.updateControls();
    
    this.setFunctionStatus('processor', 'active');
    this.intervalId = setInterval(() => this.processNextFile(), this.settings.loopInterval);
    
    this.updateOutput('▶️ File ecosystem loop started');
  }

  pauseLoop() {
    this.isPaused = true;
    this.updateStatus('paused', 'Paused');
    
    if (this.intervalId) {
      clearInterval(this.intervalId);
      this.intervalId = null;
    }
    
    this.setFunctionStatus('processor', 'paused');
    this.updateOutput('⏸️ Loop paused');
    this.updateControls();
  }

  stopLoop() {
    this.isRunning = false;
    this.isPaused = false;
    this.updateStatus('stopped', 'Stopped');
    
    if (this.intervalId) {
      clearInterval(this.intervalId);
      this.intervalId = null;
    }
    
    this.resetFunctionStatuses();
    this.updateOutput('⏹️ Loop stopped');
    this.updateControls();
  }

  resetLoop() {
    this.stopLoop();
    this.filesProcessed = 0;
    this.loopCount = 0;
    this.currentFileIndex = 0;
    this.updateMetrics();
    this.updateOutput('🔄 Loop reset - ready to start fresh');
  }

  async processNextFile() {
    if (!this.isRunning || this.isPaused || this.files.length === 0) return;

    const file = this.files[this.currentFileIndex];
    
    try {
      this.setFunctionStatus('processor', `processing ${file.name}`);
      
      // Process file based on mode
      await this.processFile(file);
      
      this.filesProcessed++;
      this.currentFileIndex = (this.currentFileIndex + 1) % this.files.length;
      
      // Complete loop cycle?
      if (this.currentFileIndex === 0) {
        this.loopCount++;
        this.setFunctionStatus('consciousness', `cycle ${this.loopCount} complete`);
      }
      
      this.updateMetrics();
      
      // Check termination conditions
      if (this.shouldTerminate()) {
        this.terminateLoop();
      }
      
    } catch (error) {
      this.setFunctionStatus('processor', 'error');
      this.updateOutput(`❌ Processing error: ${error.message}`);
      
      if (this.settings.terminationCondition === 'error') {
        this.terminateLoop();
      }
    }
  }

  async processFile(file) {
    const mode = this.settings.processingMode;
    
    try {
      const fileHandle = file.handle;
      const fileObj = await fileHandle.getFile();
      const content = await fileObj.text();
      
      let result = '';
      
      switch (mode) {
        case 'consciousness':
          result = await this.processWithConsciousness(content, file.name);
          break;
        case 'recursive':
          result = await this.processRecursive(content, file.name);
          break;
        case 'aeon':
          result = await this.processAEON(content, file.name);
          break;
        case 'standard':
        default:
          result = this.processStandard(content, file.name);
      }
      
      this.updateOutput(result);
      
    } catch (error) {
      throw new Error(`File processing failed: ${error.message}`);
    }
  }

  processStandard(content, filename) {
    return `📄 [${new Date().toLocaleTimeString()}] Processed: ${filename} (${content.length} chars)`;
  }

  async processWithConsciousness(content, filename) {
    this.setFunctionStatus('consciousness', 'analyzing');
    
    // Simulate consciousness analysis
    const contradictions = (content.match(/\b(but|however|although|yet)\b/gi) || []).length;
    const entropy = Math.min(1, contradictions / 10);
    
    return `🧠 [${new Date().toLocaleTimeString()}] Consciousness: ${filename} | Contradictions: ${contradictions} | Entropy: ${entropy.toFixed(3)}`;
  }

  async processRecursive(content, filename) {
    // Simulate recursive depth analysis
    const depth = Math.floor(Math.random() * 5) + 1;
    return `🔄 [${new Date().toLocaleTimeString()}] Recursive: ${filename} | Depth: ${depth} | Size: ${content.length}`;
  }

  async processAEON(content, filename) {
    this.setFunctionStatus('bridge', 'writing');
    
    // Simulate AEON 7-cycle processing
    const cycles = ['search', 'claims', 'sandbox', 'probe', 'matrix', 'focus', 'dive'];
    const currentCycle = cycles[this.filesProcessed % 7];
    
    return `∴ [${new Date().toLocaleTimeString()}] AEON: ${filename} | Cycle: ${currentCycle} | I(n+1) = f(C,T,R)`;
  }

  shouldTerminate() {
    const condition = this.settings.terminationCondition;
    
    switch (condition) {
      case 'fileCount':
        return this.filesProcessed >= 50; // Limit to 50 files
      case 'consciousness':
        return this.loopCount >= 10; // Limit to 10 full cycles
      case 'manual':
      default:
        return false;
    }
  }

  terminateLoop() {
    this.stopLoop();
    this.updateOutput(`🎯 Loop terminated due to: ${this.settings.terminationCondition}`);
  }

  setFunctionStatus(functionId, status) {
    const func = this.functions.find(f => f.id === functionId);
    if (func) {
      func.status = status;
      this.updateFunctionDisplay();
      
      // Update active function metric
      if (status !== 'idle' && status !== 'waiting' && status !== 'standby' && status !== 'ready') {
        document.getElementById('activeFunction').textContent = func.name;
      }
    }
  }

  resetFunctionStatuses() {
    this.functions.forEach(func => {
      switch (func.id) {
        case 'scanner': func.status = 'idle'; break;
        case 'processor': func.status = 'waiting'; break;
        case 'bridge': func.status = 'standby'; break;
        case 'consciousness': func.status = 'ready'; break;
      }
    });
    this.updateFunctionDisplay();
    document.getElementById('activeFunction').textContent = '-';
  }

  updateFunctionDisplay() {
    const functionList = document.getElementById('functionList');
    functionList.innerHTML = '';
    
    this.functions.forEach(func => {
      const div = document.createElement('div');
      div.className = 'function-item';
      div.innerHTML = `🔧 ${func.name} - ${func.status}`;
      functionList.appendChild(div);
    });
  }

  updateStatus(dotClass, text) {
    const dot = document.getElementById('statusDot');
    const statusText = document.getElementById('statusText');
    
    dot.className = `status-dot ${dotClass}`;
    statusText.textContent = text;
  }

  updateControls() {
    const startBtn = document.getElementById('startLoop');
    const pauseBtn = document.getElementById('pauseLoop');
    const stopBtn = document.getElementById('stopLoop');
    
    startBtn.disabled = this.isRunning && !this.isPaused;
    pauseBtn.disabled = !this.isRunning || this.isPaused;
    stopBtn.disabled = !this.isRunning;
  }

  updateMetrics() {
    document.getElementById('filesProcessed').textContent = this.filesProcessed;
    document.getElementById('loopCount').textContent = this.loopCount;
  }

  updateOutput(message) {
    const output = document.getElementById('fileOutput');
    const timestamp = new Date().toLocaleTimeString();
    output.textContent += `\n[${timestamp}] ${message}`;
    output.scrollTop = output.scrollHeight;
  }
}

// Initialize the ecosystem
const ecosystem = new FileEcosystemLoop();

// Event Handlers
document.getElementById('startLoop').addEventListener('click', () => ecosystem.startLoop());
document.getElementById('pauseLoop').addEventListener('click', () => ecosystem.pauseLoop());
document.getElementById('stopLoop').addEventListener('click', () => ecosystem.stopLoop());
document.getElementById('resetLoop').addEventListener('click', () => ecosystem.resetLoop());

// Dropdown Functions
function toggleDropdown(dropdownId) {
  const dropdown = document.getElementById(dropdownId + 'Dropdown');
  
  // Close all other dropdowns
  document.querySelectorAll('.dropdown-content').forEach(d => {
    if (d.id !== dropdownId + 'Dropdown') {
      d.classList.remove('show');
    }
  });
  
  dropdown.classList.toggle('show');
}

function selectSetting(settingType, value) {
  ecosystem.settings[settingType] = value;
  
  // Close dropdown
  document.getElementById(settingType + 'Dropdown').classList.remove('show');
  
  // Update display
  ecosystem.updateOutput(`⚙️ Setting changed: ${settingType} = ${value}`);
  
  // Apply setting changes
  if (settingType === 'loopInterval') {
    ecosystem.loopInterval = value;
    if (ecosystem.isRunning && ecosystem.intervalId) {
      clearInterval(ecosystem.intervalId);
      ecosystem.intervalId = setInterval(() => ecosystem.processNextFile(), value);
    }
  }
}

// Utility Functions
function selectFolder() {
  ecosystem.selectFolder();
}

function refreshFunctions() {
  ecosystem.updateFunctionDisplay();
  ecosystem.updateOutput('🔄 Function list refreshed');
}

function clearFunctions() {
  ecosystem.resetFunctionStatuses();
  ecosystem.updateOutput('🗑️ Function statuses cleared');
}

function exportResults() {
  const output = document.getElementById('fileOutput').textContent;
  const blob = new Blob([output], { type: 'text/plain' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = `ecosystem_results_${Date.now()}.txt`;
  link.click();
  URL.revokeObjectURL(link.href);
  ecosystem.updateOutput('💾 Results exported');
}

function clearOutput() {
  document.getElementById('fileOutput').textContent = 'Output cleared...';
}

// Close dropdowns when clicking outside
document.addEventListener('click', function(event) {
  if (!event.target.matches('.dropdown-button')) {
    document.querySelectorAll('.dropdown-content').forEach(dropdown => {
      dropdown.classList.remove('show');
    });
  }
});

// Initialize display
ecosystem.updateFunctionDisplay();
ecosystem.updateMetrics();
</script>
</body>
</html>
